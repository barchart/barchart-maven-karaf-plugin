<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">

	<modelVersion>4.0.0</modelVersion>

	<parent>
		<groupId>com.barchart.base</groupId>
		<artifactId>barchart-archon</artifactId>
		<version>2.5.0</version>
		<relativePath />
	</parent>

	<groupId>com.barchart.maven</groupId>
	<artifactId>barchart-maven-karaf-plugin</artifactId>
	<version>0.0.0</version>
	<packaging>pom</packaging>

	<description>Manage project SCM.</description>

	<properties>

		<gitUrl>scm:git:git://github.com/apache/karaf.git</gitUrl>
		<gitFolder>${basedir}/target/checkout</gitFolder>
		<gitModule>tooling/karaf-maven-plugin</gitModule>

		<karafVersion>3.0.0.RC1</karafVersion>

	</properties>

	<profiles>

		<!-- Get updated source. -->
		<profile>
			<id>checkout</id>
			<build>
				<plugins>

					<plugin>
						<groupId>org.apache.maven.plugins</groupId>
						<artifactId>maven-scm-plugin</artifactId>
						<version>1.7</version>
						<configuration>
							<connectionType>connection</connectionType>
							<connectionUrl>${gitUrl}</connectionUrl>
							<checkoutDirectory>${gitFolder}</checkoutDirectory>
						</configuration>
						<executions>
							<execution>
								<id>checkout</id>
								<phase>generate-sources</phase>
								<goals>
									<goal>checkout</goal>
								</goals>
								<configuration>
									<skipCheckoutIfExists>true</skipCheckoutIfExists>
									<scmVersion>trunk</scmVersion>
									<scmVersionType>branch</scmVersionType>
								</configuration>
							</execution>
							<execution>
								<id>update</id>
								<phase>generate-sources</phase>
								<goals>
									<goal>update</goal>
								</goals>
								<configuration>
								</configuration>
							</execution>
						</executions>
					</plugin>

				</plugins>
			</build>
		</profile>

		<!-- Produce git diff between Apache and Barchart. -->
		<profile>
			<id>difference</id>
			<build>
				<plugins>


				</plugins>
			</build>
		</profile>

		<profile>
			<id>verify</id>
			<build>
				<plugins>
					<plugin>
						<groupId>org.apache.maven.plugins</groupId>
						<artifactId>maven-invoker-plugin</artifactId>
						<version>1.7</version>
						<configuration>
							<streamLogs>true</streamLogs>
							<projectsDirectory>${basedir}/src-main-it</projectsDirectory>
							<cloneProjectsTo>${basedir}/target/it</cloneProjectsTo>
							<pomIncludes>
								<path>test-aggregate-features/pom.xml</path>
							</pomIncludes>
							<postBuildHookScript>verify</postBuildHookScript>
							<goals>
								<goal>install</goal>
							</goals>
						</configuration>
						<executions>
							<execution>
								<id>integration-test</id>
								<goals>
									<goal>install</goal>
									<goal>run</goal>
								</goals>
							</execution>
						</executions>
						<dependencies>
							<dependency>
								<groupId>xmlunit</groupId>
								<artifactId>xmlunit</artifactId>
								<version>1.3</version>
							</dependency>
						</dependencies>
					</plugin>
				</plugins>
			</build>
		</profile>
	</profiles>

</project>
